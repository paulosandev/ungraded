{% comment %}
  SecciÃ³n principal para productos sellados
  DiseÃ±o personalizado con estructura especÃ­fica
{% endcomment %}

<div class="sellado-product-container">
  <div class="sellado-product-wrapper">
    <!-- Layout principal de dos columnas -->
    <div class="sellado-main-layout">
      <!-- ===== COLUMNA IZQUIERDA ===== -->
      <div class="sellado-left-column">
        <!-- Tarjeta principal del producto -->
        <div class="sellado-product-card">
          <!-- Imagen del producto -->
          <div class="sellado-product-image">
            {% if product.featured_media %}
              <img
                src="{{ product.featured_media | image_url: width: 400 }}"
                alt="{{ product.featured_media.alt | escape }}"
                width="400"
                height="400"
                loading="lazy"
              >
            {% else %}
              <div class="sellado-product-placeholder">ðŸ“¦</div>
            {% endif %}
          </div>
        </div>

        <!-- GalerÃ­a de imÃ¡genes adicionales -->
        <div class="sellado-image-gallery">
          {% for media in product.media limit: 4 %}
            {% unless forloop.first %}
              <div class="sellado-gallery-item">
                {% if media.media_type == 'image' %}
                  <img
                    src="{{ media | image_url: width: 150 }}"
                    alt="{{ media.alt | escape }}"
                    width="150"
                    height="150"
                    loading="lazy"
                  >
                {% else %}
                  <div class="sellado-media-placeholder">ðŸŽ¬</div>
                {% endif %}
              </div>
            {% endunless %}
          {% endfor %}

          <!-- Rellenar con placeholders si hay menos de 3 imÃ¡genes adicionales -->
          {% assign additional_images = product.media.size | minus: 1 %}
          {% if additional_images < 3 %}
            {% for i in (1..3) %}
              {% assign current_index = additional_images | plus: forloop.index %}
              {% if current_index <= 3 %}
                <div class="sellado-gallery-item">
                  <div class="sellado-gallery-placeholder">ðŸ“·</div>
                </div>
              {% endif %}
            {% endfor %}
          {% endif %}
        </div>
      </div>

      <!-- ===== COLUMNA DERECHA ===== -->
      <div class="sellado-right-column">
        <!-- TÃ­tulo del producto -->
        <div class="sellado-product-title">
          <h1>{{ product.title }}</h1>
        </div>

        <!-- Contenido en dos subcolumnas -->
        <div class="sellado-content-layout">
          <!-- Sub-columna izquierda: InformaciÃ³n del producto -->
          <div class="sellado-info-column">
            <!-- Precio -->
            <div class="sellado-product-price">
              {% if product.compare_at_price > product.price %}
                <span class="sellado-price-compare">{{ product.compare_at_price | money }}</span>
              {% endif %}
              <span class="sellado-price-current">{{ product.price | money }}</span>
            </div>

            <!-- Estado de disponibilidad -->
            <div class="sellado-availability">
              {% if product.available %}
                <span class="sellado-status available">DISPONIBLE</span>
              {% else %}
                <span class="sellado-status unavailable">AGOTADO</span>
              {% endif %}
            </div>

            <!-- InformaciÃ³n adicional -->
            <div class="sellado-product-details">
              {% comment %} Extraer informaciÃ³n de los tags del producto {% endcomment %}
              {% assign idioma_value = 'N/A' %}
              {% assign entrega_value = 'N/A' %}

              {% for tag in product.tags %}
                {% if tag contains 'Idioma_' %}
                  {% assign idioma_value = tag | remove: 'Idioma_' %}
                {% elsif tag contains 'Entrega_' %}
                  {% assign entrega_value = tag | remove: 'Entrega_' %}
                {% endif %}
              {% endfor %}

              <div class="sellado-detail-line">
                <span class="sellado-detail-label">Entrega aproximada:</span>
                <span class="sellado-detail-value">{{ entrega_value }}</span>
              </div>

              <div class="sellado-detail-line">
                <span class="sellado-detail-label">Idioma:</span>
                <span class="sellado-detail-value">{{ idioma_value }}</span>
              </div>

              <div class="sellado-detail-line">
                <span class="sellado-detail-label">DescripciÃ³n:</span>
                <div class="sellado-detail-description">
                  {% if product.description != blank %}
                    {{ product.description | strip_html | truncate: 150 }}
                  {% else %}
                    Producto sellado de alta calidad para coleccionistas.
                  {% endif %}
                </div>
              </div>
            </div>

            <!-- BotÃ³n de agregar al carrito -->
            <div class="sellado-product-buttons">
              <form action="/cart/add" method="post" enctype="multipart/form-data" class="sellado-product-form">
                {% unless product.has_only_default_variant %}
                  <div class="sellado-variants">
                    <select name="id" class="sellado-variant-select">
                      {% for variant in product.variants %}
                        <option
                          value="{{ variant.id }}"
                          {% if variant.available == false %}
                            disabled
                          {% endif %}
                        >
                          {{ variant.title }} - {{ variant.price | money }}
                        </option>
                      {% endfor %}
                    </select>
                  </div>
                {% else %}
                  <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                {% endunless %}

                <button
                  type="submit"
                  class="sellado-add-to-cart-btn"
                  {% unless product.available %}
                    disabled
                  {% endunless %}
                >
                  {% if product.available %}
                    AGREGAR AL CARRITO
                  {% else %}
                    AGOTADO
                  {% endif %}
                </button>
              </form>
            </div>
          </div>

          <!-- Sub-columna derecha: Productos relacionados y personajes -->
          <div class="sellado-related-column">
            <!-- Productos relacionados (versiÃ³n reducida) -->
            <div class="sellado-related-products">
              <h3 class="sellado-related-title">Â¿Te puede interesar?</h3>
              <div class="sellado-related-grid">
                {%- comment -%}
                  Tomamos productos de la primera colecciÃ³n del producto SIN filtrar por disponibilidad para asegurarnos de mostrar hasta 4.
                  Luego excluimos el producto actual y evitamos duplicados.
                {%- endcomment -%}
                {% assign related_products = collections[product.collections.first.handle].products %}
                {% assign products_added = '' %}
                {% assign products_count = 0 %}

                {% for related_product in related_products limit: 4 %}
                  {% unless products_added contains related_product.id %}
                    {% unless related_product.id == product.id %}
                      {% if products_count < 4 %}
                        {% assign products_added = products_added | append: related_product.id | append: ',' %}
                        {% assign products_count = products_count | plus: 1 %}

                        <div class="sellado-related-item">
                          <a href="{{ related_product.url }}">
                            <div class="sellado-related-image">
                              {% if related_product.featured_media %}
                                <img
                                  src="{{ related_product.featured_media | image_url: width: 120 }}"
                                  alt="{{ related_product.featured_media.alt | escape }}"
                                  width="120"
                                  height="120"
                                  loading="lazy"
                                >
                              {% else %}
                                <div class="sellado-related-placeholder">ðŸ“¦</div>
                              {% endif %}
                            </div>
                            <div class="sellado-related-info">
                              <h4 class="sellado-related-product-title">{{ related_product.title | truncate: 30 }}</h4>
                              <p class="sellado-related-price">{{ related_product.price | money }}</p>
                            </div>
                          </a>
                        </div>
                      {% endif %}
                    {% endunless %}
                  {% endunless %}
                {% endfor %}
              </div>
            </div>

            <!-- Personajes -->
            <div class="sellado-characters">
              {% if section.settings.characters_image %}
                <img
                  src="{{ section.settings.characters_image | image_url: width: 250 }}"
                  alt="{{ section.settings.characters_image.alt | escape }}"
                  width="250"
                  height="200"
                  class="sellado-characters-image"
                >
              {% else %}
                <div class="sellado-characters-placeholder">
                  <span class="character-icon">ðŸŽ®</span>
                  <span class="character-icon">âš¡</span>
                  <span class="character-icon">ðŸ”¥</span>
                </div>
              {% endif %}
            </div>

            <!-- Mensaje personalizado -->
            <div class="sellado-custom-message" style="--sellado-message-size:{{ section.settings.message_size }}px;">
              <p class="message-line-1">{{ section.settings.message_line_1 | default: 'Â¡ABRIRLO' }}</p>
              <p class="message-line-2">{{ section.settings.message_line_2 | default: 'O NO ABRIRLO?' }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{{ 'section-main-product-sellado.css' | asset_url | stylesheet_tag }}

{% schema %}
{
  "name": "Producto Sellado",
  "settings": [
    {
      "type": "header",
      "content": "ConfiguraciÃ³n Producto Sellado"
    },
    {
      "type": "image_picker",
      "id": "characters_image",
      "label": "Imagen de personajes"
    },
    {
      "type": "text",
      "id": "message_line_1",
      "label": "LÃ­nea 1 del mensaje",
      "default": "Â¡ABRIRLO"
    },
    {
      "type": "text",
      "id": "message_line_2",
      "label": "LÃ­nea 2 del mensaje",
      "default": "O NO ABRIRLO?"
    },
    {
      "type": "range",
      "id": "message_size",
      "label": "TamaÃ±o del texto (px)",
      "min": 14,
      "max": 50,
      "step": 1,
      "default": 24
    },
    {
      "type": "header",
      "content": "ConfiguraciÃ³n de productos relacionados"
    },
    {
      "type": "range",
      "id": "related_products_count",
      "min": 2,
      "max": 4,
      "step": 1,
      "default": 4,
      "label": "NÃºmero de productos relacionados"
    }
  ],
  "presets": [
    {
      "name": "Producto Sellado"
    }
  ]
}
{% endschema %}
