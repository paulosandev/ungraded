{% comment %}
  Renders cart drawer con diseño personalizado

  Usage:
  {% render 'cart-drawer-custom' %}
{% endcomment %}

{{ 'quantity-popover.css' | asset_url | stylesheet_tag }}
{{ 'component-card.css' | asset_url | stylesheet_tag }}

<script src="{{ 'cart.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'quantity-popover.js' | asset_url }}" defer="defer"></script>
<!-- Unified cart system will handle all cart functionality -->
<script src="{{ 'custom-cart-drawer.js' | asset_url }}" defer="defer"></script>

<style>
  .drawer {
    visibility: hidden;
  }
</style>

<cart-drawer class="drawer{% if cart == empty %} is-empty{% endif %}">
  <div id="CartDrawer" class="cart-drawer">
    <div id="CartDrawer-Overlay" class="cart-drawer__overlay"></div>
    <div
      class="drawer__inner gradient color-{{ settings.cart_color_scheme }}"
      role="dialog"
      aria-modal="true"
      aria-label="{{ 'sections.cart.title' | t }}"
      tabindex="-1"
    >
      {% comment %} Header con subtotal y botón {% endcomment %}
      <div class="drawer__header">
        <button
          class="drawer__close"
          type="button"
          onclick="this.closest('cart-drawer').close()"
          aria-label="{{ 'accessibility.close' | t }}"
        >
          <span class="svg-wrapper">
          {{- 'icon-close.svg' | inline_asset_content -}}
        </span>
      </button>

        {%- if cart != empty -%}
          <div class="cart-header-content">
            <div class="cart-subtotal-section">
              <h2 class="cart-subtotal-label">Subtotal</h2>
              <div class="cart-subtotal-amount">
                {%- if cart.total_price > 0 -%}
                  {{ cart.total_price | money }}
                {%- else -%}
                  $0.00 MXN
                {%- endif -%}
              </div>
            </div>
            
            {% comment %} Botón ir al carrito {% endcomment %}
            <button
              type="submit"
              id="CartDrawer-Checkout"
              class="cart__checkout-button"
              name="checkout"
              form="CartDrawer-Form"
            >
              Ir al carrito
            </button>
          </div>
        {%- endif -%}
      </div>
      
      <cart-drawer-items
        {% if cart == empty %}
          class=" is-empty"
        {% endif %}
      >
        <form
          action="{{ routes.cart_url }}"
          id="CartDrawer-Form"
          class="cart__contents cart-drawer__form"
          method="post"
        >
          <div id="CartDrawer-CartItems" class="drawer__contents js-contents">
            {%- if cart != empty -%}
              <div class="drawer__cart-items-wrapper">
                {%- for item in cart.items -%}
                  <div id="CartDrawer-Item-{{ item.index | plus: 1 }}" class="cart-item">
                    
                    <!-- 1. IMAGEN DEL PRODUCTO (ARRIBA) -->
                    <div class="cart-item__media">
                      {% if item.image %}
                        <img
                          class="cart-item__image"
                          src="{{ item.image | image_url: width: 400 }}"
                          alt="{{ item.image.alt | escape }}"
                          loading="lazy"
                          width="400"
                          height="{{ 400 | divided_by: item.image.aspect_ratio | ceil }}"
                        >
                      {% else %}
                        <div class="cart-item__placeholder">
                          {{ 'product-1' | placeholder_svg_tag: 'cart-item__image' }}
                        </div>
                      {% endif %}
                    </div>

                    <!-- 2. TÍTULO DEL PRODUCTO -->
                    <div class="cart-item__details">
                      <h3 class="cart-item__name">
                        <a href="{{ item.url }}">
                          {{- item.product.title | escape -}}
                        </a>
                      </h3>
                    </div>

                    <!-- 3. PRECIO DEL PRODUCTO -->
                    <div class="cart-item__price">
                      <span class="cart-item__price-amount">
                        {{ item.line_price | money }}
                      </span>
                    </div>

                    <!-- 4. CONTROLES DE CANTIDAD -->
                    <div class="cart-item__quantity">
                      <quantity-input class="quantity" data-index="{{ item.index | plus: 1 }}">
                        <button class="quantity__button quantity__button--minus" name="minus" type="button">
                          <span class="visually-hidden">
                            {{- 'products.product.quantity.decrease' | t: product: item.product.title | escape -}}
                          </span>
                          <span class="svg-wrapper">
                            {{- 'icon-minus.svg' | inline_asset_content -}}
                          </span>
                        </button>
                        <input
                          class="quantity__input"
                          type="number"
                          name="updates[]"
                          value="{{ item.quantity }}"
                          {% # theme-check-disable %}
                          data-cart-quantity="{{ cart | item_count_for_variant: item.variant.id }}"
                          min="0"
                          data-min="{{ item.variant.quantity_rule.min }}"
                          {% comment %} Exponer el inventario disponible para limitar la cantidad máxima desde JS {% endcomment %}
                          data-max-inventory="{{ item.variant.inventory_quantity }}"
                          {% if item.variant.inventory_quantity != null and item.variant.inventory_quantity > 0 %}
                            max="{{ item.variant.inventory_quantity }}"
                          {% endif %}
                          {% if item.variant.quantity_rule.max != null %}
                            max="{{ item.variant.quantity_rule.max }}"
                          {% endif %}
                          step="{{ item.variant.quantity_rule.increment }}"
                          {% # theme-check-enable %}
                          aria-label="{{ 'products.product.quantity.input_label' | t: product: item.product.title | escape }}"
                          id="Drawer-quantity-{{ item.index | plus: 1 }}"
                          data-index="{{ item.index | plus: 1 }}"
                        >
                        <button class="quantity__button quantity__button--plus" name="plus" type="button">
                          <span class="visually-hidden">
                            {{- 'products.product.quantity.increase' | t: product: item.product.title | escape -}}
                          </span>
                          <span class="quantity__button-text">+</span>
                        </button>
                      </quantity-input>
                    </div>
                    
                  </div>
                {%- endfor -%}
              </div>
            {%- else -%}
              {% comment %} Contenido del carrito vacío {% endcomment %}
              <div class="cart-drawer__empty-content">
                <div class="empty-cart-icon">
                  🛒
                </div>
                <h2 class="empty-cart-title">Tu carrito está vacío</h2>
                <p class="empty-cart-message">Añade algunos productos para comenzar a comprar</p>
                <a href="{{ routes.all_products_collection_url }}" class="continue-shopping-btn">
                  Continuar comprando
                </a>
              </div>
            {%- endif -%}
          </div>
        </form>
      </cart-drawer-items>
    </div>
  </div>
</cart-drawer> 